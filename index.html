<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Joyce Window ROI Estimator (ZIP + J2/J31 + Tiers)</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="preconnect" href="https://cdn.jsdelivr.net">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<style>
  :root{--brand:#0C5AA6;--accent:#18A957;--muted:#eef3f8;--ink:#1b1f23}
  *{box-sizing:border-box}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--ink);margin:0;background:#fff}
  .wrap{max-width:1100px;margin:auto;padding:24px}
  h1{font-size:1.6rem;margin:0 0 6px}
  .sub{color:#5b6670;margin:0 0 18px}
  .grid{display:grid;grid-template-columns:1.1fr .9fr;gap:18px}
  @media (max-width: 920px){.grid{grid-template-columns:1fr}}
  .card{background:#fff;border:1px solid #e3e8ee;border-radius:12px;padding:16px}
  .card h3{margin:0 0 12px;font-size:1.05rem}
  label{display:block;font-size:.9rem;margin:8px 0 4px}
  input[type="number"], input[type="text"], select{
    width:100%;padding:10px;border:1px solid #d6dde6;border-radius:8px;font-size:.95rem;background:#fff
  }
  .row{display:flex;gap:12px;align-items:center}
  .row > *{flex:1}
  .opt{display:flex;align-items:center;gap:8px;margin:6px 0}
  .opt input{transform:scale(1.05)}
  .tier{display:flex;gap:10px;flex-wrap:wrap}
  .tier label{display:flex;align-items:center;gap:8px;border:1px solid #dfe5ee;border-radius:10px;padding:8px 10px;cursor:pointer;background:#f9fbff}
  .pill{display:inline-block;background:var(--muted);padding:4px 10px;border-radius:999px;font-size:.82rem}
  .range{display:flex;align-items:center;gap:10px}
  input[type="range"]{flex:1}
  .kpi{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin:16px 0}
  .kpi .box{background:#fff;border:1px solid #e3e8ee;border-radius:10px;padding:12px;text-align:center}
  .kpi .val{font-weight:700;font-size:1.05rem}
  .note{font-size:.85rem;color:#5b6670}
  .hi{color:var(--accent);font-weight:700}
  .cta{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
  button{background:var(--brand);color:#fff;border:0;border-radius:10px;padding:10px 14px;font-weight:600;cursor:pointer}
  button.secondary{background:#f3f6fa;color:#0b1220;border:1px solid #dfe5ee}
  .divider{height:1px;background:#e8edf3;margin:12px 0}
  .muted{opacity:.7}
</style>
</head>
<body>
<div class="wrap">
  <h1>Window ROI Estimator</h1>
  <p class="sub">See your potential ROI from Joyce replacement windows by combining <span class="pill">resale value</span> + <span class="pill">energy savings</span>. Use the <strong>years</strong> slider to watch ROI grow over time, and pick a <strong>Good / Better / Best</strong> option to reflect your preferences.</p>

  <div class="grid">
    <!-- Left column: Inputs -->
    <div class="card">
      <h3>1) Project, Pricing & ZIP</h3>

      <div class="row">
        <div>
          <label>ZIP Code <span class="note muted">(sets regional energy inflation)</span></label>
          <input type="text" id="zip" value="44114" maxlength="10" placeholder="e.g., 44114">
        </div>
        <div>
          <label>Energy Inflation (%/yr)</label>
          <input type="number" id="infl" value="3.5" step="0.1" min="0" max="10">
        </div>
      </div>
      <div class="cta" style="margin:6px 0 10px">
        <button type="button" onclick="applyZip()">Apply ZIP</button>
        <button type="button" class="secondary" onclick="clearZip()">Clear ZIP</button>
        <span id="zipMsg" class="note"></span>
      </div>

      <div class="row">
        <div>
          <label>Number of Windows</label>
          <input type="number" id="numWindows" value="12" min="1" step="1">
        </div>
        <div>
          <label>Avg Monthly Energy Bill ($)</label>
          <input type="number" id="bill" value="250" min="50" step="10">
        </div>
      </div>

      <div class="divider"></div>

      <h3>2) Choose Your Package</h3>
      <div class="tier" role="group" aria-label="Good Better Best">
        <label><input type="radio" name="tier" value="good" checked> <strong>Good</strong> <span class="note">($900–$1,100 • J2)</span></label>
        <label><input type="radio" name="tier" value="better"> <strong>Better</strong> <span class="note">($1,250–$1,600 • J31)</span></label>
        <label><input type="radio" name="tier" value="best"> <strong>Best</strong> <span class="note">($1,400–$1,900 • J31)</span></label>
      </div>

      <div class="row" style="margin-top:10px">
        <div>
          <label>Per‑Window Price (within selected tier)</label>
          <div class="range">
            <input type="range" id="priceSlider" min="900" max="1900" step="25" value="1000" oninput="priceOut.textContent='$'+fmt(this.value)">
            <span id="priceOut">$1,000</span>
          </div>
        </div>
        <div>
          <label>Efficiency Improvement (%)</label>
          <div class="range">
            <input type="range" id="effSlider" min="10" max="40" step="1" value="18" oninput="effOut.textContent=this.value+'%'">
            <span id="effOut">18%</span>
          </div>
        </div>
      </div>

      <!-- Upgrades: Paint +$300, Hardware +$100, Triple-pane +$100 -->
      <div class="opt"><input type="checkbox" id="optPaint"><label for="optPaint" style="margin:0">Painted Exterior (+$300)</label></div>
      <div class="opt"><input type="checkbox" id="optHardware"><label for="optHardware" style="margin:0">Hardware Upgrade (+$100)</label></div>
      <div class="opt"><input type="checkbox" id="optTriple"><label for="optTriple" style="margin:0">Triple-Pane Glass (+$100)</label></div>

      <div class="note">Good = <strong>J2 glass</strong> (double Low‑E). Better/Best include <strong>J31</strong> (quad Low‑E + Super Spacer). Triple‑pane is an optional upgrade (typically chosen with Best).</div>

      <div class="divider"></div>

      <h3>3) Time Horizon & Resale</h3>
      <div class="row">
        <div class="range">
          <label style="min-width:120px">Years in Home</label>
          <input type="range" id="years" min="1" max="30" value="15" oninput="yearsOut.textContent=this.value">
          <span id="yearsOut">15</span>
        </div>
        <div>
          <label>Resale Recoup Rate (%)</label>
          <input type="number" id="recoup" value="70" min="40" max="95" step="1">
        </div>
      </div>
      <div>
        <label>Include Resale Value at Year</label>
        <input type="number" id="sellYear" value="10" min="1" step="1">
      </div>
    </div>

    <!-- Right column: KPIs + Chart + Details -->
    <div class="card">
      <h3>Results</h3>

      <div class="kpi">
        <div class="box"><div class="val" id="kpiCost">$—</div><div class="note">Total Investment</div></div>
        <div class="box"><div class="val" id="kpiResale">$—</div><div class="note">Resale Value Recoup</div></div>
        <div class="box"><div class="val" id="kpiSave">$—</div><div class="note">Cumulative Energy Savings</div></div>
        <div class="box"><div class="val" id="kpiROI">$—</div><div class="note">Total ROI (at year)</div></div>
      </div>

      <canvas id="roiChart" height="220" aria-label="ROI Over Time"></canvas>
      <div class="note" id="breakEvenNote" style="margin-top:8px"></div>

      <div class="divider"></div>
      <div id="details" class="note"></div>

      <div class="cta">
        <button type="button" onclick="calc(true)">Recalculate</button>
        <button type="button" class="secondary" onclick="resetDefaults()">Reset</button>
      </div>
      <p class="note" style="margin-top:6px">Educational estimate. Actual savings depend on home size, climate, installation, and energy mix.</p>
    </div>
  </div>
</div>

<script>
  // Utilities
  const $ = (id)=>document.getElementById(id);
  const fmt = (n)=> Number(n).toLocaleString(undefined,{maximumFractionDigits:0});
  const money = (n)=> '$'+fmt(n);

  // ZIP -> region map (by first digit). Simple, transparent heuristic.
  // 0–2 Northeast, 3–4 Southeast/Mid-Atlantic, 5–6 Midwest/Central, 7 South Central, 8 Mountain, 9 West
  const regionInflationDefaults = {
    '0': 4.0, '1': 4.0, '2': 3.8, // Northeast
    '3': 3.2, '4': 3.2,          // Southeast / Mid-Atlantic
    '5': 3.0, '6': 3.1,          // Midwest / Central
    '7': 3.3,                    // South Central
    '8': 3.4,                    // Mountain
    '9': 3.6                     // West
  };

  // Chart
  const ctx = $('roiChart').getContext('2d');
  const chart = new Chart(ctx, {
    type:'line',
    data:{ labels:[], datasets:[
      {label:'Cumulative Energy Savings', data:[], borderColor:'#18A957', backgroundColor:'rgba(24,169,87,.12)', tension:.25, fill:true},
      {label:'Total ROI (Savings + Resale – Cost)', data:[], borderColor:'#0C5AA6', backgroundColor:'rgba(12,90,166,.1)', tension:.25, fill:true},
    ]},
    options:{
      responsive:true,
      plugins:{legend:{position:'bottom'}},
      scales:{y:{ticks:{callback:(v)=>'$'+fmt(v)}}}
    }
  });

  // Tier presets with correct glass packages and defaults
  const tiers = {
    good:   { min: 900,  max: 1100, defaultEff: 18, opts:{paint:false, hardware:false, triple:false, glass:"J2 (Double Low-E)"} },
    better: { min: 1250, max: 1600, defaultEff: 24, opts:{paint:true,  hardware:true,  triple:false, glass:"J31 (Quad Low-E + Super Spacer)"} },
    best:   { min: 1400, max: 1900, defaultEff: 28, opts:{paint:true,  hardware:true,  triple:true,  glass:"J31 (Quad Low-E + Super Spacer)"} }
  };

  function clampPriceToTier(val, tier){
    const t = tiers[tier];
    return Math.min(t.max, Math.max(t.min, Number(val)));
  }

  function setTierUI(tier){
    const t = tiers[tier];

    // Price slider bounds + midpoint
    $('priceSlider').min = t.min;
    $('priceSlider').max = t.max;
    const mid = Math.round((t.min + t.max)/2);
    const current = Number($('priceSlider').value);
    $('priceSlider').value = (current < t.min || current > t.max) ? mid : current;
    $('priceOut').textContent = money($('priceSlider').value);

    // Efficiency defaults to tier
    $('effSlider').value = t.defaultEff;
    $('effOut').textContent = t.defaultEff + '%';

    // Options
    $('optPaint').checked    = t.opts.paint;
    $('optHardware').checked = t.opts.hardware;
    $('optTriple').checked   = t.opts.triple;
  }

  function applyZip(){
    const z = $('zip').value.trim();
    const digit = (z.match(/\d/)||[])[0];
    if(!digit){ $('zipMsg').textContent='Enter a valid ZIP to set regional inflation.'; return; }
    const inf = regionInflationDefaults[digit];
    if(inf){
      $('infl').value = inf.toFixed(1);
      $('zipMsg').textContent = `ZIP applied → Regional energy inflation set to ${inf.toFixed(1)}%/yr.`;
      calc(true);
    } else {
      $('zipMsg').textContent='ZIP area not recognized; left inflation unchanged.';
    }
  }
  function clearZip(){ $('zip').value=''; $('zipMsg').textContent=''; }

  function inputs(){
    const tier = document.querySelector('input[name="tier"]:checked').value;
    const numWindows = +$('numWindows').value;

    // Base per-window price from slider (within tier range)
    const basePerWindow = clampPriceToTier($('priceSlider').value, tier);
    let perWindow = +basePerWindow;

    // Upgrades (paint $300, hardware $100, triple-pane $100)
    if ($('optPaint').checked) perWindow += 300;
    if ($('optHardware').checked) perWindow += 100;
    if ($('optTriple').checked) perWindow += 100;

    const eff = +$('effSlider').value / 100;

    return {
      tier,
      numWindows,
      perWindow,
      investment: numWindows * perWindow,
      recoup: +$('recoup').value / 100,
      sellYear: Math.max(1, Math.min(30, +$('sellYear').value)),
      bill: +$('bill').value,
      eff,
      years: +$('years').value,
      infl: +$('infl').value / 100,
      basePerWindow
    };
  }

  function series(i){
    const yrs=[], savingsCum=[], roiCum=[];
    let bill = i.bill, saveTotal=0, resale=0;

    for(let y=1; y<=i.years; y++){
      const yearSave = bill * i.eff * 12; // savings in that year
      saveTotal += yearSave;
      if(y === i.sellYear) resale = i.investment * i.recoup;

      const roi = saveTotal + resale - i.investment;
      yrs.push('Y'+y);
      savingsCum.push(Math.round(saveTotal));
      roiCum.push(Math.round(roi));

      bill *= (1 + i.infl); // next year's (inflated) bill
    }
    return {yrs, savingsCum, roiCum, finalSavings: saveTotal, resale, finalROI: roiCum.at(-1)};
  }

  function breakEven(roiArr){
    for(let i=0;i<roiArr.length;i++){ if(roiArr[i]>=0) return i+1; }
    return null;
  }

  function calc(updateChart=false){
    const i = inputs();
    const s = series(i);

    $('kpiCost').textContent   = money(i.investment);
    $('kpiResale').textContent = money(s.resale);
    $('kpiSave').textContent   = money(s.finalSavings);
    $('kpiROI').textContent    = (s.finalROI>=0?'+':'') + money(s.finalROI);

    if(updateChart){
      chart.data.labels = s.yrs;
      chart.data.datasets[0].data = s.savingsCum;
      chart.data.datasets[1].data = s.roiCum;
      chart.update();
    }

    const be = breakEven(s.roiCum);
    $('breakEvenNote').innerHTML = be
      ? `📍 <span class="hi">Break‑even in year ${be}</span> — cumulative ROI turns positive.`
      : `📍 ROI remains negative by year ${i.years}. Try increasing years, efficiency, or resale recoup.`;

    $('details').innerHTML = `
      <div><strong>TIER:</strong> ${i.tier.toUpperCase()} | <strong>Glass:</strong> ${tiers[i.tier].opts.glass} | <strong>Base per‑window:</strong> ${money(i.basePerWindow)}</div>
      <div><strong>Selected upgrades:</strong> ${
        ['optPaint','optHardware','optTriple'].filter(id=>$(id).checked).map(id=>({optPaint:'Paint (+$300)',optHardware:'Hardware (+$100)',optTriple:'Triple-pane (+$100)'}[id])).join(', ') || 'None'
      }</div>
      <div><strong>Installed cost:</strong> ${i.numWindows} × ${money(i.perWindow)} = <strong>${money(i.investment)}</strong></div>
      <div><strong>Efficiency:</strong> ${(i.eff*100).toFixed(0)}% on $${fmt(i.bill)}/mo bill; <strong>energy inflation:</strong> ${(i.infl*100).toFixed(1)}%/yr</div>
      <div><strong>Resale:</strong> ${Math.round(i.recoup*100)}% at year ${i.sellYear} → ${money(s.resale)}</div>
      <div class="note">Better/Best tiers include J31 (quad Low‑E + Super Spacer). Triple‑pane adds further insulation.</div>
    `;
  }

  function resetDefaults(){
    $('zip').value='44114'; $('zipMsg').textContent='';
    $('infl').value=3.5;
    $('numWindows').value=12;
    $('bill').value=250;

    // Default to BEST for a strong showcase, or switch to GOOD by changing this line:
    document.querySelector('input[name="tier"][value="best"]').checked=true;
    setTierUI('best'); // sets price slider, efficiency, options

    $('years').value=15; $('yearsOut').textContent='15';
    $('recoup').value=70;
    $('sellYear').value=10;
    calc(true);
  }

  // Event wiring
  document.addEventListener('input', (e)=>{
    if (['priceSlider','effSlider','numWindows','bill','years','infl','recoup','sellYear','optPaint','optHardware','optTriple'].includes(e.target.id)){
      if(e.target.id==='years') $('yearsOut').textContent = $('years').value;
      if(e.target.id==='priceSlider') $('priceOut').textContent = money(e.target.value);
      if(e.target.id==='effSlider') $('effOut').textContent = e.target.value + '%';
      calc(true);
    }
  });
  document.querySelectorAll('input[name="tier"]').forEach(r=>{
    r.addEventListener('change', ()=>{ setTierUI(r.value); calc(true); });
  });

  // Init
  resetDefaults();
</script>
</body>
</html>
